{% extends "base.html" %}
{% from "_formhelpers.html" import render_field %}
{% block title %}Search user{% endblock %}
{% block content %}
<div class="jumbotron">
    <p>Search user</p>
</div>
<div class="row">
    <div class="col-lg-8 offset-lg-4">
        {% for message in get_flashed_messages() %}
        {{ message }}
        {% endfor %}
    </div>
    <div class="col-lg-12">
        <form method="POST">
            {{ form.csrf_token }}
            {{ render_field(form.username) }}
            {{ form.submit() }}
        </form>
    </div>
    <div class="col-lg-12">
        {% if users %}
        <table class="table">
            <thead>
                <th>#</th>
                <th>Image</th>
                <th>Username</th>
                <th>Friend Request</th>
            </thead>
            <tbody>
                {% for user in users %}
                <tr>
                    <th>{{ loop.index }}</th>
                    {% if user.picture_path %}
                    <th>
                        <img class="user-img-small" src="{{url_for('static', filename=user.picture_path)}}" alt="Image">
                    </th>
                    {% else %}
                    <th></th>
                    {% endif %}
                    <th>{{ user.username }}</th>
                    <th>
                        {% if user.joined_status_from_to == -1 %}
                        Blocking
                        {% elif user.joined_status_to_from == -1 %}
                        Blocked
                        {% else %}
                            {% if user.joined_status_from_to == 2 or user.joined_status_to_from == 2 %}
                            Friend
                            <form action="{{url_for('app.connect_user')}}" method="POST">
                                {{ connect_form.csrf_token }}
                                {{ connect_form.connect_condition(value="remove") }}
                                {{ connect_form.to_user_id(value=user.id) }}
                                {{ connect_form.to_username(value=user.username) }}
                                {{ connect_form.submit(class='btn btn-danger', value=("Remove")) }}
                            </form>
                            {% elif user.joined_status_to_from == 1 %}
                            <form action="{{url_for('app.connect_user')}}" method="POST">
                                {{ connect_form.csrf_token }}
                                {{ connect_form.connect_condition(value="accept") }}
                                {{ connect_form.to_user_id(value=user.id) }}
                                {{ connect_form.to_username(value=user.username) }}
                                {{ connect_form.submit(class='btn btn-success', value=("Accept")) }}
                            </form>
                            <form action="{{url_for('app.connect_user')}}" method="POST">
                                {{ connect_form.csrf_token }}
                                {{ connect_form.connect_condition(value="reject") }}
                                {{ connect_form.to_user_id(value=user.id) }}
                                {{ connect_form.to_username(value=user.username) }}
                                {{ connect_form.submit(class='btn btn-danger', value=("Reject")) }}
                            </form>
                            {% elif user.joined_status_from_to == 1 %}
                            Requesting
                            {% else %}
                            <form action="{{url_for('app.connect_user')}}" method="POST">
                                {{ connect_form.csrf_token }}
                                {{ connect_form.connect_condition(value="request") }}
                                {{ connect_form.to_user_id(value=user.id) }}
                                {{ connect_form.to_username(value=user.username) }}
                                {{ connect_form.submit(class='btn btn-primary', value=("Request")) }}
                            </form>
                            {% endif %}
                            <form action="{{url_for('app.connect_user')}}" method="POST">
                                {{ connect_form.csrf_token }}
                                {{ connect_form.connect_condition(value="block") }}
                                {{ connect_form.to_user_id(value=user.id) }}
                                {{ connect_form.to_username(value=user.username) }}
                                {{ connect_form.submit(class='btn btn-danger', value=("Block")) }}
                            </form>
                        {% endif %}
                    </th>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% endif %}
    </div>
</div>
{% endblock %}
